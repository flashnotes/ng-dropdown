"use strict";!function(e){e.module("ng-dropdown",[]).service("DropdownService",function(){this.dropdowns=[],this.open=function(e){var n=this.dropdowns[e];n.element.addClass(n.activeClass),n.menuElement.addClass(n.openClass),n.opened=!0},this.close=function(e){var n=this.dropdowns[e];n.element.removeClass(n.activeClass),n.menuElement.removeClass(n.openClass),n.opened=!1},this.toggle=function(e){var n=this.dropdowns[e];n.opened?this.close(e):this.open(e)}}).directive("dropdown",["$document","$parse","DropdownService",function(n,o,t){return{restrict:"A",scope:{dropdown:"=?",disabled:"&dropdownDisabled",opened:"@"},link:function(o,d,r){function i(){o.opened||o.$apply(function(){t.menuElement.addClass(w),t.element.addClass(v),o.opened=!0;var e=t.dropdowns[o.dropdown];e.opened=!0})}function l(){o.$apply(function(){t.menuElement.removeClass(w),t.element.removeClass(v),o.opened=!1;var e=t.dropdowns[o.dropdown];e.opened=!1,c()})}function p(){o.opened?l():i()}function s(){return Array.prototype.map.call(t.menuElement.children(),function(e){return e})}function c(){o.currentOption&&(e.element(o.currentOption).removeClass(v),delete o.currentOption)}function u(){if(i(),m){var n=m.indexOf(o.currentOption)+1;c(),o.currentOption=m.length>n?m[n]:m[0]}else m=s(),o.currentOption=m[0];e.element(o.currentOption).addClass(v),t.menuElement[0].scrollTop=o.currentOption.offsetTop}function a(){if(i(),m){var n=m.indexOf(o.currentOption)-1;c(),o.currentOption=n>=0?m[n]:m[m.length-1]}else m=s(),o.currentOption=m[0];e.element(o.currentOption).addClass(v),t.menuElement[0].scrollTop=o.currentOption.offsetTop}var m,f=d[0].querySelector(".ng-dropdown-field"),w=r.dropdownOpenClass||"open",v=r.dropdownActiveClass||"active";o.opened=!1,o.dropdown={id:t.dropdowns.length},t.dropdowns[o.dropdown.id]={activeClass:v,openClass:w,element:d,menuElement:e.element(document.getElementById(r.dropdownMenu))},o.$watch("disabled()",function(e){e?d.addClass("dropdown-disabled"):d.removeClass("dropdown-disabled")}),e.element(document.getElementById(r.dropdownMenu)).bind("mouseenter",function(){c()}),d.bind("click",function(n){if(!o.disabled()){var i=e.element(document.getElementById(r.dropdownMenu));t.menuElement&&t.menuElement.attr("id")!==i.attr("id")&&l(),t.menuElement=i,t.element=d,n.preventDefault(),n.stopPropagation(),p()}}),n.bind("keydown",function(n){if(!o.disabled()&&(o.opened||document.activeElement===f)&&-1!==[9,27,40,38,13].indexOf(n.keyCode)){if(t.element=d,t.menuElement=e.element(document.getElementById(r.dropdownMenu)),9===n.keyCode)return void l();n.preventDefault(),n.stopPropagation(),27===n.keyCode?l():40===n.keyCode?u():38===n.keyCode?a():13===n.keyCode&&(o.currentOption&&o.opened&&document.activeElement===f?o.currentOption.click():o.opened||document.activeElement!==f||i())}}),n.bind("click",function(e){o.opened&&e.target!==t.menuElement&&l()})}}}])}(window.angular);