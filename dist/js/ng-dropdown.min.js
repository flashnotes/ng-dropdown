angular.module("ng-dropdown",[]).factory("DropdownService",function(){return{element:null,menuElement:null}}).directive("dropdown",["$document","$parse","DropdownService",function(e,n,t){return{restrict:"A",scope:{disabled:"&dropdownDisabled",opened:"@"},link:function(n,o,d){function r(){n.opened||n.$apply(function(){t.menuElement.addClass(f),t.element.addClass(v),n.opened=!0})}function l(){n.opened&&n.$apply(function(){t.menuElement.removeClass(f),t.element.removeClass(v),n.opened=!1,a()})}function i(){n.opened?l():r()}function u(){return Array.prototype.map.call(t.menuElement.children(),function(e){return e})}function a(){n.currentOption&&(angular.element(n.currentOption).removeClass(v),delete n.currentOption)}function c(){if(r(),m){var e=m.indexOf(n.currentOption)+1;a(),n.currentOption=m.length>e?m[e]:m[0]}else m=u(),n.currentOption=m[0];angular.element(n.currentOption).addClass(v)}function p(){if(r(),m){var e=m.indexOf(n.currentOption)-1;a(),n.currentOption=e>=0?m[e]:m[m.length-1]}else m=u(),n.currentOption=m[0];angular.element(n.currentOption).addClass(v)}var m,s=o[0].querySelector(".ng-dropdown-field"),f=d.dropdownOpenClass||"open",v=d.dropdownActiveClass||"active";n.opened=!1,n.$watch("disabled()",function(e){e?o.addClass("dropdown-disabled"):o.removeClass("dropdown-disabled")}),angular.element(document.getElementById(d.dropdownMenu)).bind("mouseenter",function(){a()}),o.bind("click",function(e){if(!n.disabled()){var r=angular.element(document.getElementById(d.dropdownMenu));t.menuElement&&t.menuElement.attr("id")!==r.attr("id")&&l(),t.menuElement=r,t.element=o,e.preventDefault(),e.stopPropagation(),i()}}),e.bind("keydown",function(e){if(!n.disabled()&&(n.opened||document.activeElement===s)){if(9===e.keyCode)return void l();e.preventDefault(),e.stopPropagation(),t.element=o,t.menuElement=angular.element(document.getElementById(d.dropdownMenu)),27===e.keyCode?l():40===e.keyCode?c():38===e.keyCode?p():13===e.keyCode&&(n.currentOption&&n.opened&&document.activeElement===s?n.currentOption.click():n.opened||document.activeElement!==s||r())}}),e.bind("click",function(){n.opened&&event.target!==t.menuElement&&l()})}}}]);