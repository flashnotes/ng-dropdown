angular.module("ng-dropdown",[]).factory("DropdownService",function(){return{element:null,menuElement:null}}).directive("dropdown",["$document","$parse","DropdownService",function(e,n,t){return{restrict:"A",scope:{disabled:"&dropdownDisabled",opened:"@"},link:function(n,o,r){function d(){n.opened||n.$apply(function(){t.menuElement.addClass(f),t.element.addClass(v),n.opened=!0})}function l(){n.$apply(function(){t.menuElement.removeClass(f),t.element.removeClass(v),n.opened=!1,c()})}function i(){n.opened?l():d()}function u(){return Array.prototype.map.call(t.menuElement.children(),function(e){return e})}function c(){n.currentOption&&(angular.element(n.currentOption).removeClass(v),delete n.currentOption)}function a(){if(d(),m){var e=m.indexOf(n.currentOption)+1;c(),n.currentOption=m.length>e?m[e]:m[0]}else m=u(),n.currentOption=m[0];angular.element(n.currentOption).addClass(v),t.menuElement[0].scrollTop=n.currentOption.offsetTop}function p(){if(d(),m){var e=m.indexOf(n.currentOption)-1;c(),n.currentOption=e>=0?m[e]:m[m.length-1]}else m=u(),n.currentOption=m[0];angular.element(n.currentOption).addClass(v),t.menuElement[0].scrollTop=n.currentOption.offsetTop}var m,s=o[0].querySelector(".ng-dropdown-field"),f=r.dropdownOpenClass||"open",v=r.dropdownActiveClass||"active";n.opened=!1,n.$watch("disabled()",function(e){e?o.addClass("dropdown-disabled"):o.removeClass("dropdown-disabled")}),angular.element(document.getElementById(r.dropdownMenu)).bind("mouseenter",function(){c()}),o.bind("click",function(e){if(!n.disabled()){var d=angular.element(document.getElementById(r.dropdownMenu));t.menuElement&&t.menuElement.attr("id")!==d.attr("id")&&l(),t.menuElement=d,t.element=o,e.preventDefault(),e.stopPropagation(),i()}}),e.bind("keydown",function(e){if(!n.disabled()&&(n.opened||document.activeElement===s)&&-1!==[9,27,40,38,13].indexOf(e.keyCode)){if(t.element=o,t.menuElement=angular.element(document.getElementById(r.dropdownMenu)),9===e.keyCode)return void l();e.preventDefault(),e.stopPropagation(),27===e.keyCode?l():40===e.keyCode?a():38===e.keyCode?p():13===e.keyCode&&(n.currentOption&&n.opened&&document.activeElement===s?n.currentOption.click():n.opened||document.activeElement!==s||d())}}),e.bind("click",function(e){n.opened&&e.target!==t.menuElement&&l()})}}}]);