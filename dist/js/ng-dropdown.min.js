"use strict";!function(e){e.module("ng-dropdown",[]).service("DropdownService",["$document",function(e){this.dropdowns=[],this.open=function(e){var n=this,t=this.dropdowns[e];t.opened||((this.currentlyOpen||0===this.currentlyOpen)&&this.close(this.currentlyOpen),t.element.addClass(t.activeClass),t.menuElement.addClass(t.openClass),t.opened=!0,setTimeout(function(){return n.currentlyOpen=e},0))},this.close=function(e){var n=this.dropdowns[e];n.opened&&(n.element.removeClass(n.activeClass),n.menuElement.removeClass(n.openClass),n.opened=!1,delete this.currentlyOpen)},this.disable=function(e){var n=this.dropdowns[e];n.element.addClass("dropdown-disabled"),n.disabled=!0},this.enable=function(e){var n=this.dropdowns[e];n.element.removeClass("dropdown-disabled"),n.disabled=!1},this.toggle=function(e){var n=this.dropdowns[e];n.opened?this.close(e):this.open(e)},this.documentClickHandler=function(e){if(this.currentlyOpen||0===this.currentlyOpen){var n=this.dropdowns[this.currentlyOpen];n.menuElement===e.target||n.disableDocumentClick||this.close(this.currentlyOpen)}},e.bind("click",this.documentClickHandler),this.clickHandler=function(e){var n=this;return function(){e.disabled||e.disableClick||n.toggle(e.id)}}}]).directive("dropdown",["$document","$parse","DropdownService",function(n,t,o){return{restrict:"A",scope:{dropdown:"=?",disabled:"=?dropdownDisabled"},link:function(t,d,i){function r(){return Array.prototype.map.call(o.menuElement.children(),function(e){return e})}function l(){t.currentOption&&(e.element(t.currentOption).removeClass(f),delete t.currentOption)}function s(){if(o.open(p.id),u){var n=u.indexOf(t.currentOption)+1;l(),t.currentOption=u.length>n?u[n]:u[0]}else u=r(),t.currentOption=u[0];e.element(t.currentOption).addClass(f),o.menuElement[0].scrollTop=t.currentOption.offsetTop}function c(){if(o.open(p.id),u){var n=u.indexOf(t.currentOption)-1;l(),t.currentOption=n>=0?u[n]:u[u.length-1]}else u=r(),t.currentOption=u[0];e.element(t.currentOption).addClass(f),o.menuElement[0].scrollTop=t.currentOption.offsetTop}var u,p,a=d[0].querySelector(".ng-dropdown-field"),m=i.dropdownOpenClass||"open",f=i.dropdownActiveClass||"active";p={id:o.dropdowns.length,activeClass:f,openClass:m,element:d,menuElement:e.element(document.getElementById(i.dropdownMenu))},t.dropdown=o.dropdowns[p.id]=p,t.$watch("disabled",function(e){e?o.disable(p.id):o.enable(p.id)}),e.element(document.getElementById(i.dropdownMenu)).bind("mouseenter",function(){l()}),d.bind("click",o.clickHandler(p)),n.bind("keydown",function(n){if(!p.disabled&&(p.opened||document.activeElement===a)&&-1!==[9,27,40,38,13].indexOf(n.keyCode)){if(o.element=d,o.menuElement=e.element(document.getElementById(i.dropdownMenu)),9===n.keyCode)return void o.close(p.id);n.preventDefault(),n.stopPropagation(),27===n.keyCode?o.close(p.id):40===n.keyCode?s():38===n.keyCode?c():13===n.keyCode&&(t.currentOption&&p.opened&&document.activeElement===a?t.currentOption.click():p.opened||document.activeElement!==a||o.open(p.id))}})}}}])}(window.angular);